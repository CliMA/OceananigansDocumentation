<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spatial operators · Oceananigans.jl</title><link rel="canonical" href="https://climate-machine.github.io/Oceananigans.jl/latest/manual/spatial_operators/index.html"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Oceananigans.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../equations/">Continuous equations</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Numerical methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../finite_volume/">Finite volume method</a></li><li><a class="tocitem" href="../staggered_grid/">Staggered grid</a></li><li><a class="tocitem" href="../fractional_step/">Fractional step method</a></li><li><a class="tocitem" href="../time_stepping/">Time stepping</a></li><li class="is-active"><a class="tocitem" href>Spatial operators</a><ul class="internal"><li><a class="tocitem" href="#Differences-1"><span>Differences</span></a></li><li><a class="tocitem" href="#Interpolation-1"><span>Interpolation</span></a></li><li><a class="tocitem" href="#Divergence-and-flux-divergence-1"><span>Divergence and flux divergence</span></a></li><li><a class="tocitem" href="#Momentum-advection-1"><span>Momentum advection</span></a></li><li><a class="tocitem" href="#Viscous-dissipation-1"><span>Viscous dissipation</span></a></li><li class="toplevel"><a class="tocitem" href="#Laplacian-diffusion-1"><span>Laplacian diffusion</span></a></li></ul></li><li><a class="tocitem" href="../poisson_solvers/">Poisson solvers</a></li><li><a class="tocitem" href="../boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../turbulence_closures/">Turbulence closures</a></li><li><a class="tocitem" href="../large_eddy_simulation/">Large eddy simulation</a></li></ul></li><li><a class="tocitem" href="../model_setup/">Model setup</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../generated/simple_diffusion/">One-dimensional diffusion</a></li><li><a class="tocitem" href="../../generated/two_dimensional_turbulence/">Two-dimensional turbulence</a></li><li><a class="tocitem" href="../../generated/internal_wave/">Internal wave</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../verification/taylor_green_vortex/">Taylor-Green vortex</a></li><li><a class="tocitem" href="../../verification/lid_driven_cavity/">Lid-driven cavity</a></li><li><a class="tocitem" href="../../verification/free_convection/">Free convection</a></li><li><a class="tocitem" href="../../verification/stratified_couette_flow/">Stratified Couette flow</a></li></ul></li></ul></li><li><a class="tocitem" href="../../gallery/">Gallery</a></li><li><a class="tocitem" href="../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../library/">Library</a></li><li><a class="tocitem" href="../../subject_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Numerical methods</a></li><li class="is-active"><a href>Spatial operators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spatial operators</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/climate-machine/Oceananigans.jl/blob/master/docs/src/manual/spatial_operators.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Spatial-operators-1">Spatial operators<a class="docs-heading-anchor" href="#Spatial-operators-1" title="Permalink"></a></h1><p>To calculate the various terms and perform the time-stepping, discrete difference and interpolation operators must be designed from which all the terms, such as momentum advection and Laplacian diffusion, may be constructed. Much of the material in this section is derived from \citet{Marshall97FV}.</p><h2 id="Differences-1">Differences<a class="docs-heading-anchor" href="#Differences-1" title="Permalink"></a></h2><p>Difference operators act as the discrete form of the derivative operator. Care must be taken when calculating differences on a staggered grid. For example, the the difference of a cell-centered variable such as temperature <span>$T$</span> lies on the faces  in the direction of the difference, and vice versa. In principle, there are three difference operators, one for each  direction</p><div>\[  \delta_x f = f_E - f_W, \quad
  \delta_y f = f_N - f_S , \quad
  \delta_z f = f_T - f_B ,\]</div><p>where the <span>$E$</span> and <span>$W$</span> subscripts indicate that the value is evaluated the eastern or western wall of the cell, <span>$N$</span> and <span>$S$</span> indicate the northern and southern walls, and <span>$T$</span> and <span>$B$</span> indicate the top and bottom walls.</p><p>Additionally, two <span>$\delta$</span> operators must be defined for each direction to account for the staggered nature of the grid. One for taking the difference of a cell-centered variable and projecting it onto the cell faces</p><div>\[\begin{aligned}
    \delta_x^{faa} f_{i,j,k} &amp;= f_{i,j,k} - f_{i-1,j,k} \\
    \delta_y^{afa} f_{i,j,k} &amp;= f_{i,j,k} - f_{i,j-1,k} \\
    \delta_z^{aaf} f_{i,j,k} &amp;= f_{i,j,k} - f_{i,j,k-1}
\end{aligned}\]</div><p>and another for taking the difference of a face-centered variable and projecting it onto the cell centers</p><div>\[\begin{aligned}
    \delta_x^{caa} f_{i,j,k} &amp;= f_{i+1,j,k} - f_{i,j,k} \\
    \delta_y^{aca} f_{i,j,k} &amp;= f_{i,j+1,k} - f_{i,j,k} \\
    \delta_z^{aac} f_{i,j,k} &amp;= f_{i,j,k+1} - f_{i,j,k}
\end{aligned}\]</div><h2 id="Interpolation-1">Interpolation<a class="docs-heading-anchor" href="#Interpolation-1" title="Permalink"></a></h2><p>In order to add or multiply variables that are defined at different points they are interpolated. In our case, linear interpolation or averaging is employed. Once again, there are two averaging operators, one for each direction, \begin{equation}   \overline{f}^x = \frac{f<em>E + f</em>W}{2} , \quad   \overline{f}^y = \frac{f<em>N + f</em>S}{2} , \quad   \overline{f}^z = \frac{f<em>T + f</em>B}{2} \end{equation}</p><p>Additionally, three averaging operators must be defined for each direction. One for taking the average of a cell-centered  variable and projecting it onto the cell faces</p><div>\[\begin{aligned}
    \overline{f_{i,j,k}}^{faa} = \frac{f_{i,j,k} + f_{i-1,j,k}}{2} \\
    \overline{f_{i,j,k}}^{afa} = \frac{f_{i,j,k} + f_{i,j-1,k}}{2} \\
    \overline{f_{i,j,k}}^{aaf} = \frac{f_{i,j,k} + f_{i,j,k-1}}{2}
\end{aligned}\]</div><p>and another for taking the average of a face-centered variable and projecting it onto the cell centers</p><div>\[\begin{aligned}
    \overline{f_{i,j,k}}^{caa} = \frac{f_{i+1,j,k} + f_{i,j,k}}{2} \\
    \overline{f_{i,j,k}}^{aca} = \frac{f_{i,j+1,k} + f_{i,j,k}}{2} \\
    \overline{f_{i,j,k}}^{aac} = \frac{f_{i,j,k+1} + f_{i,j,k}}{2}
\end{aligned}\]</div><h2 id="Divergence-and-flux-divergence-1">Divergence and flux divergence<a class="docs-heading-anchor" href="#Divergence-and-flux-divergence-1" title="Permalink"></a></h2><p>The divergence of the flux of a cell-centered quantity over the cell can be calculated as</p><div>\[\nabla \cdot \bm{f}
= \frac{1}{V} \left[ \delta_x^{faa} (A_x f_x)
                   + \delta_y^{afa} (A_y f_y)
                   + \delta_z^{aaf} (A_z f_z) \right]\]</div><p>where <span>$\bm{f} = (f_x, f_y, f_z)$</span> is the flux with components defined normal to the faces, and <span>$V$</span> is the volume of the cell. The presence of a solid boundary is indicated by setting the appropriate flux normal to the boundary to zero.</p><p>A similar divergence operator can be defined for a face-centered quantity. The divergence of the flux of <span>$T$</span> over a cell,  <span>$\nabla \cdot (\bm{u} T)$</span>, required in the evaluation of <span>$G_T$</span>, for example, is then</p><div>\[\renewcommand{\div}[1] {\nabla \cdot \left ( #1 \right )}
\div{\bm{u} T}
= \frac{1}{V} \left[ \delta_x^{caa} (A_x u \overline{T}^{faa})
                   + \delta_y^{aca} (A_y v \overline{T}^{afa})
                   + \delta_z^{aac} (A_z w \overline{T}^{aaf}) \right]\]</div><p>where <span>$T$</span> is interpolated onto the cell faces where it can be multiplied by the velocities, which are then differenced and  projected onto the cell centers where they added together and then added to <span>$G_T$</span> which also lives at the cell centers.</p><h2 id="Momentum-advection-1">Momentum advection<a class="docs-heading-anchor" href="#Momentum-advection-1" title="Permalink"></a></h2><p>The advection terms that make up the <span>$\mathbf{G}$</span> terms in equations \eqref{eq:horizontalMomentum} and \eqref{eq:verticalMomentum} can be mathematically written as, e.g,</p><div>\[\renewcommand{\div}[1] {\nabla \cdot \left ( #1 \right )}
\bm{u} \cdot \nabla u
    = \div{u\bm{u}} - u(\underbrace{\nabla\cdot\bm{u}}_{=0})
    = \div{u\bm{u}}\]</div><p>which can then be discretized similarly to the flux divergence operator, however, they must be discretized differently for each direction.</p><p>For example, the <span>$x$</span>-momentum advection operator is discretized as</p><div>\[\bm{u} \cdot \nabla u
= \frac{1}{\overline{V}^x} \left[
    \delta_x^{faa} \left( \overline{A_x u}^{caa} \overline{u}^{caa} \right)
  + \delta_y^{afa} \left( \overline{A_y v}^{aca} \overline{u}^{aca} \right)
  + \delta_z^{aaf} \left( \overline{A_z w}^{aac} \overline{u}^{aac} \right)
\right]\]</div><p>where <span>$\overline{V}^x$</span> is the average of the volumes of the cells on either side of the face in question. Calculating <span>$\partial(uu)/\partial x$</span> can be performed by interpolating <span>$A_x u$</span> and <span>$u$</span> onto the cell centers then multiplying them and differencing them back onto the faces. However, in the case of the the two other terms, <span>$\partial(vu)/\partial y$</span> and <span>$\partial(wu)/\partial z$</span>, the two variables must be interpolated onto the cell edges to be multiplied then differenced back onto the cell faces.</p><h2 id="Viscous-dissipation-1">Viscous dissipation<a class="docs-heading-anchor" href="#Viscous-dissipation-1" title="Permalink"></a></h2><p>Viscous dissipation operators are discretized similarly to the momentum advection operators and so there is a different one for each direction. For example, the vertical diffusion operator is discretized as</p><div>\[\renewcommand{\div}[1] {\nabla \cdot \left ( #1 \right )}
\div{\nu \nabla w}
= \frac{1}{V} \left[
      \delta_x^{faa} \left( \nu_h \overline{A_x}^{caa} \delta_x^{caa} w \right)
    + \delta_y^{afa} \left( \nu_h \overline{A_y}^{aca} \delta_y^{aca} w \right)
    + \delta_z^{aaf} \left( \nu_v \overline{A_z}^{aac} \delta_z^{aac} w \right)
\right]\]</div><p>where <span>$\nu$</span> is the kinematic viscosity.</p><h1 id="Laplacian-diffusion-1">Laplacian diffusion<a class="docs-heading-anchor" href="#Laplacian-diffusion-1" title="Permalink"></a></h1><p>Laplacian diffusion is discretized for tracer quantities as</p><div>\[\renewcommand{\div}[1] {\nabla \cdot \left ( #1 \right )}
\div{\kappa \nabla T}
= \frac{1}{V} \left[
    \delta_x^{caa} \left( \kappa_h A_x \delta_x^{faa} T \right)
  + \delta_y^{aca} \left( \kappa_h A_y \delta_y^{afa} T \right)
  + \delta_z^{aac} \left( \kappa_v A_z \delta_z^{aaf} T \right)
\right]\]</div><p>where <span>$\kappa$</span> is the diffusivity, usually taken to be the eddy diffusivity, and different diffusivities may be taken for the horizontal and vertical directions to account for the differences between horizontal and vertical turbulence.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../time_stepping/">« Time stepping</a><a class="docs-footer-nextpage" href="../poisson_solvers/">Poisson solvers »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 23 October 2019 03:46">Wednesday 23 October 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
