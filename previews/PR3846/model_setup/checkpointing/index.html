<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Checkpointing · Oceananigans.jl</title><meta name="title" content="Checkpointing · Oceananigans.jl"/><meta property="og:title" content="Checkpointing · Oceananigans.jl"/><meta property="twitter:title" content="Checkpointing · Oceananigans.jl"/><meta name="description" content="Documentation for Oceananigans.jl."/><meta property="og:description" content="Documentation for Oceananigans.jl."/><meta property="twitter:description" content="Documentation for Oceananigans.jl."/><meta property="og:url" content="https://clima.github.io/OceananigansDocumentation/stable/model_setup/checkpointing/"/><meta property="twitter:url" content="https://clima.github.io/OceananigansDocumentation/stable/model_setup/checkpointing/"/><link rel="canonical" href="https://clima.github.io/OceananigansDocumentation/stable/model_setup/checkpointing/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Oceananigans.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quick_start/">Quick start</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/one_dimensional_diffusion/">One-dimensional diffusion</a></li><li><a class="tocitem" href="../../literated/two_dimensional_turbulence/">Two-dimensional turbulence</a></li><li><a class="tocitem" href="../../literated/internal_wave/">Internal wave</a></li><li><a class="tocitem" href="../../literated/internal_tide/">Internal tide by a seamount</a></li><li><a class="tocitem" href="../../literated/convecting_plankton/">Convecting plankton</a></li><li><a class="tocitem" href="../../literated/ocean_wind_mixing_and_convection/">Ocean wind mixing and convection</a></li><li><a class="tocitem" href="../../literated/langmuir_turbulence/">Langmuir turbulence</a></li><li><a class="tocitem" href="../../literated/baroclinic_adjustment/">Baroclinic adjustment</a></li><li><a class="tocitem" href="../../literated/kelvin_helmholtz_instability/">Kelvin-Helmholtz instability</a></li><li><a class="tocitem" href="../../literated/shallow_water_Bickley_jet/">Shallow water Bickley jet</a></li><li><a class="tocitem" href="../../literated/horizontal_convection/">Horizontal convection</a></li><li><a class="tocitem" href="../../literated/tilted_bottom_boundary_layer/">Tilted bottom boundary layer</a></li></ul></li><li><a class="tocitem" href="../../grids/">Grids</a></li><li><a class="tocitem" href="../../fields/">Fields</a></li><li><a class="tocitem" href="../../operations/">Operations</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Model setup (legacy)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../setting_initial_conditions/">Setting initial conditions</a></li><li><a class="tocitem" href="../architecture/">Architecture</a></li><li><a class="tocitem" href="../number_type/">Number type</a></li><li><a class="tocitem" href="../legacy_grids/">Grid</a></li><li><a class="tocitem" href="../clock/">Clock</a></li><li><a class="tocitem" href="../coriolis/">Coriolis (rotation)</a></li><li><a class="tocitem" href="../tracers/">Tracers</a></li><li><a class="tocitem" href="../buoyancy_and_equation_of_state/">Buoyancy models and equation of state</a></li><li><a class="tocitem" href="../boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../forcing_functions/">Forcing functions</a></li><li><a class="tocitem" href="../background_fields/">Background fields</a></li><li><a class="tocitem" href="../turbulent_diffusivity_closures_and_les_models/">Turbulent diffusivity closures and LES models</a></li><li><a class="tocitem" href="../lagrangian_particles/">Lagrangian particles</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li><li><a class="tocitem" href="../output_writers/">Output writers</a></li><li class="is-active"><a class="tocitem" href>Checkpointing</a><ul class="internal"><li><a class="tocitem" href="#Picking-up-a-simulation-from-a-checkpoint-file"><span>Picking up a simulation from a checkpoint file</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/notation/">Coordinate system and notation</a></li><li><a class="tocitem" href="../../physics/boussinesq/">Boussinesq approximation</a></li><li><input class="collapse-toggle" id="menuitem-8-3" type="checkbox"/><label class="tocitem" for="menuitem-8-3"><span class="docs-label"><code>NonhydrostaticModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/nonhydrostatic_model/">Nonhydrostatic model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-4" type="checkbox"/><label class="tocitem" for="menuitem-8-4"><span class="docs-label"><code>HydrostaticFreeSurfaceModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/hydrostatic_free_surface_model/">Hydrostatic model with a free surface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-5" type="checkbox"/><label class="tocitem" for="menuitem-8-5"><span class="docs-label"><code>ShallowWaterModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/shallow_water_model/">Shallow water model</a></li></ul></li><li><a class="tocitem" href="../../physics/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../physics/buoyancy_and_equations_of_state/">Buoyancy models and equations of state</a></li><li><a class="tocitem" href="../../physics/coriolis_forces/">Coriolis forces</a></li><li><a class="tocitem" href="../../physics/turbulence_closures/">Turbulence closures</a></li><li><a class="tocitem" href="../../physics/surface_gravity_waves/">Surface gravity waves and the Craik-Leibovich approximation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Numerical implementation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../numerical_implementation/finite_volume/">Finite volume method</a></li><li><a class="tocitem" href="../../numerical_implementation/spatial_operators/">Spatial operators</a></li><li><a class="tocitem" href="../../numerical_implementation/pressure_decomposition/">Pressure decomposition</a></li><li><a class="tocitem" href="../../numerical_implementation/time_stepping/">Time stepping</a></li><li><a class="tocitem" href="../../numerical_implementation/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../numerical_implementation/elliptic_solvers/">Elliptic solvers</a></li><li><a class="tocitem" href="../../numerical_implementation/large_eddy_simulation/">Large eddy simulation</a></li></ul></li><li><a class="tocitem" href="../../simulation_tips/">Simulation tips</a></li><li><a class="tocitem" href="../../contributing/">Contributor&#39;s guide</a></li><li><a class="tocitem" href="../../gallery/">Gallery</a></li><li><a class="tocitem" href="../../references/">References</a></li><li><input class="collapse-toggle" id="menuitem-14" type="checkbox"/><label class="tocitem" for="menuitem-14"><span class="docs-label">Appendix</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../appendix/staggered_grid/">Staggered grid</a></li><li><a class="tocitem" href="../../appendix/fractional_step/">Fractional step method</a></li><li><a class="tocitem" href="../../appendix/convergence_tests/">Convergence tests</a></li><li><a class="tocitem" href="../../appendix/benchmarks/">Performance benchmarks</a></li><li><a class="tocitem" href="../../appendix/library/">Library</a></li><li><a class="tocitem" href="../../appendix/function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model setup (legacy)</a></li><li class="is-active"><a href>Checkpointing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Checkpointing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/Oceananigans.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/Oceananigans.jl/blob/main/docs/src/model_setup/checkpointing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="checkpointing"><a class="docs-heading-anchor" href="#checkpointing">Checkpointing</a><a id="checkpointing-1"></a><a class="docs-heading-anchor-permalink" href="#checkpointing" title="Permalink"></a></h1><p>A <a href="../../appendix/library/#Oceananigans.OutputWriters.Checkpointer-Tuple{Any}"><code>Checkpointer</code></a> can be used to serialize the entire model state to a file from which the model can be restored at any time. This is useful if you&#39;d like to periodically checkpoint when running long simulations in case of crashes or hitting cluster time limits, but also if you&#39;d like to restore from a checkpoint and try out multiple scenarios.</p><p>For example, to periodically checkpoint the model state to disk every 1,000,000 seconds of simulation time to files of the form <code>model_checkpoint_iteration12500.jld2</code> where <code>12500</code> is the iteration number (automatically filled in).</p><p>Here&#39;s an example where we checkpoint every 5 iterations. This is far more often than appropriate for typical applications: we only do it here for illustration purposes.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Oceananigans</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = NonhydrostaticModel(grid=RectilinearGrid(size=(8, 8, 8), extent=(1, 1, 1)))</code><code class="nohighlight hljs ansi" style="display:block;">NonhydrostaticModel{CPU, RectilinearGrid}(time = 0 seconds, iteration = 0)
├── grid: 8×8×8 RectilinearGrid{Float64, Periodic, Periodic, Bounded} on CPU with 3×3×3 halo
├── timestepper: RungeKutta3TimeStepper
├── advection scheme: Centered reconstruction order 2
├── tracers: ()
├── closure: Nothing
├── buoyancy: Nothing
└── coriolis: Nothing</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulation = Simulation(model, Δt=1, stop_iteration=8)</code><code class="nohighlight hljs ansi" style="display:block;">Simulation of NonhydrostaticModel{CPU, RectilinearGrid}(time = 0 seconds, iteration = 0)
├── Next time step: 1 second
├── Elapsed wall time: 0 seconds
├── Wall time per iteration: NaN days
├── Stop time: Inf days
├── Stop iteration : 8.0
├── Wall time limit: Inf
├── Callbacks: OrderedDict with 4 entries:
│   ├── stop_time_exceeded =&gt; Callback of stop_time_exceeded on IterationInterval(1)
│   ├── stop_iteration_exceeded =&gt; Callback of stop_iteration_exceeded on IterationInterval(1)
│   ├── wall_time_limit_exceeded =&gt; Callback of wall_time_limit_exceeded on IterationInterval(1)
│   └── nan_checker =&gt; Callback of NaNChecker for u on IterationInterval(100)
├── Output writers: OrderedDict with no entries
└── Diagnostics: OrderedDict with no entries</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulation.output_writers[:checkpointer] = Checkpointer(model, schedule=IterationInterval(5), prefix=&quot;model_checkpoint&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">Checkpointer{IterationInterval, Vector{Symbol}}(IterationInterval(5, 0), &quot;.&quot;, &quot;model_checkpoint&quot;, [:grid, :timestepper, :particles, :clock, :coriolis, :buoyancy, :closure], false, false, false)</code></pre><p>Again, for illustration purposes of this example, we also add another callback so we can see the iteration of the simulation</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; show_iteration(sim) = @info &quot;iteration: $(iteration(sim)); time: $(prettytime(sim.model.clock.time))&quot;</code><code class="nohighlight hljs ansi" style="display:block;">show_iteration (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_callback!(simulation, show_iteration, name=:info, IterationInterval(1))</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now let&#39;s run</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; run!(simulation)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Initializing simulation...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 0; time: 0 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... simulation initialization complete (3.790 seconds)
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Executing initial time step...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... initial time step complete (5.664 seconds).
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 1; time: 1 second
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 2; time: 2.000 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 3; time: 3 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 4; time: 4 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 5; time: 5 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 6; time: 6 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 7; time: 7 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Simulation is stopping after running for 9.495 seconds.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Model iteration 8 equals or exceeds stop iteration 8.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 8; time: 8 seconds</code></pre><p>The default options should provide checkpoint files that are easy to restore from (in most cases). For more advanced options and features, see <a href="../../appendix/library/#Oceananigans.OutputWriters.Checkpointer-Tuple{Any}"><code>Checkpointer</code></a>.</p><h2 id="Picking-up-a-simulation-from-a-checkpoint-file"><a class="docs-heading-anchor" href="#Picking-up-a-simulation-from-a-checkpoint-file">Picking up a simulation from a checkpoint file</a><a id="Picking-up-a-simulation-from-a-checkpoint-file-1"></a><a class="docs-heading-anchor-permalink" href="#Picking-up-a-simulation-from-a-checkpoint-file" title="Permalink"></a></h2><p>Picking up a simulation from a checkpoint requires the original script that was used to generate the checkpoint data. Change the first instance of <a href="../../appendix/library/#Oceananigans.Simulations.run!-Tuple{Any}"><code>run!</code></a> in the script to take <code>pickup=true</code>.</p><p>When <code>pickup=true</code> is provided to <code>run!</code> then it finds the latest checkpoint file in the current working directory, loads prognostic fields and their tendencies from file, resets the model clock and iteration, to the clock time and iteration that the checkpoint corresponds to, and updates the model auxiliary state. After that, the time-stepping loop. In this simple example, although the simulation run up to iteration 8, the latest checkpoint is associated with iteration 5.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulation.stop_iteration = 12</code><code class="nohighlight hljs ansi" style="display:block;">12</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; run!(simulation, pickup=true)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Initializing simulation...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... simulation initialization complete (1.120 ms)
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Executing initial time step...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... initial time step complete (4.961 ms).
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 6; time: 6 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 7; time: 7 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 8; time: 8 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 9; time: 9 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 10; time: 10 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 11; time: 11 seconds
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Simulation is stopping after running for 38.746 ms.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Model iteration 12 equals or exceeds stop iteration 12.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>iteration: 12; time: 12 seconds</code></pre><p>Use <code>pickup=iteration</code>, where <code>iteration</code> is an <code>Integer</code>, to pick up from a specific iteration. Or, use <code>pickup=filepath</code>, where <code>filepath</code> is a string, to pickup from a specific file located at <code>filepath</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../output_writers/">« Output writers</a><a class="docs-footer-nextpage" href="../../physics/notation/">Coordinate system and notation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 21 October 2024 11:45">Monday 21 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
