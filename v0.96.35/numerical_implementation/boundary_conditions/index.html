<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Boundary conditions · Oceananigans.jl</title><meta name="title" content="Boundary conditions · Oceananigans.jl"/><meta property="og:title" content="Boundary conditions · Oceananigans.jl"/><meta property="twitter:title" content="Boundary conditions · Oceananigans.jl"/><meta name="description" content="Documentation for Oceananigans.jl."/><meta property="og:description" content="Documentation for Oceananigans.jl."/><meta property="twitter:description" content="Documentation for Oceananigans.jl."/><meta property="og:url" content="https://clima.github.io/OceananigansDocumentation/stable/numerical_implementation/boundary_conditions/"/><meta property="twitter:url" content="https://clima.github.io/OceananigansDocumentation/stable/numerical_implementation/boundary_conditions/"/><link rel="canonical" href="https://clima.github.io/OceananigansDocumentation/stable/numerical_implementation/boundary_conditions/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Oceananigans.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quick_start/">Quick start</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../literated/one_dimensional_diffusion/">One-dimensional diffusion</a></li><li><a class="tocitem" href="../../literated/two_dimensional_turbulence/">Two-dimensional turbulence</a></li><li><a class="tocitem" href="../../literated/internal_wave/">Internal wave</a></li><li><a class="tocitem" href="../../literated/internal_tide/">Internal tide by a seamount</a></li><li><a class="tocitem" href="../../literated/convecting_plankton/">Convecting plankton</a></li><li><a class="tocitem" href="../../literated/ocean_wind_mixing_and_convection/">Ocean wind mixing and convection</a></li><li><a class="tocitem" href="../../literated/langmuir_turbulence/">Langmuir turbulence</a></li><li><a class="tocitem" href="../../literated/baroclinic_adjustment/">Baroclinic adjustment</a></li><li><a class="tocitem" href="../../literated/kelvin_helmholtz_instability/">Kelvin-Helmholtz instability</a></li><li><a class="tocitem" href="../../literated/shallow_water_Bickley_jet/">Shallow water Bickley jet</a></li><li><a class="tocitem" href="../../literated/horizontal_convection/">Horizontal convection</a></li><li><a class="tocitem" href="../../literated/tilted_bottom_boundary_layer/">Tilted bottom boundary layer</a></li></ul></li><li><a class="tocitem" href="../../grids/">Grids</a></li><li><a class="tocitem" href="../../fields/">Fields</a></li><li><a class="tocitem" href="../../operations/">Operations</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Model setup (legacy)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_setup/overview/">Overview</a></li><li><a class="tocitem" href="../../model_setup/setting_initial_conditions/">Setting initial conditions</a></li><li><a class="tocitem" href="../../model_setup/architecture/">Architecture</a></li><li><a class="tocitem" href="../../model_setup/number_type/">Number type</a></li><li><a class="tocitem" href="../../model_setup/legacy_grids/">Grid</a></li><li><a class="tocitem" href="../../model_setup/clock/">Clock</a></li><li><a class="tocitem" href="../../model_setup/coriolis/">Coriolis (rotation)</a></li><li><a class="tocitem" href="../../model_setup/tracers/">Tracers</a></li><li><a class="tocitem" href="../../model_setup/buoyancy_and_equation_of_state/">Buoyancy models and equation of state</a></li><li><a class="tocitem" href="../../model_setup/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../model_setup/forcing_functions/">Forcing functions</a></li><li><a class="tocitem" href="../../model_setup/background_fields/">Background fields</a></li><li><a class="tocitem" href="../../model_setup/turbulent_diffusivity_closures_and_les_models/">Turbulent diffusivity closures and LES models</a></li><li><a class="tocitem" href="../../model_setup/lagrangian_particles/">Lagrangian particles</a></li><li><a class="tocitem" href="../../model_setup/diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../model_setup/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../model_setup/output_writers/">Output writers</a></li><li><a class="tocitem" href="../../model_setup/checkpointing/">Checkpointing</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/notation/">Coordinate system and notation</a></li><li><a class="tocitem" href="../../physics/boussinesq/">Boussinesq approximation</a></li><li><input class="collapse-toggle" id="menuitem-8-3" type="checkbox"/><label class="tocitem" for="menuitem-8-3"><span class="docs-label"><code>NonhydrostaticModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/nonhydrostatic_model/">Nonhydrostatic model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-4" type="checkbox"/><label class="tocitem" for="menuitem-8-4"><span class="docs-label"><code>HydrostaticFreeSurfaceModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/hydrostatic_free_surface_model/">Hydrostatic model with a free surface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-5" type="checkbox"/><label class="tocitem" for="menuitem-8-5"><span class="docs-label"><code>ShallowWaterModel</code></span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/shallow_water_model/">Shallow water model</a></li></ul></li><li><a class="tocitem" href="../../physics/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../physics/buoyancy_and_equations_of_state/">Buoyancy models and equations of state</a></li><li><a class="tocitem" href="../../physics/coriolis_forces/">Coriolis forces</a></li><li><a class="tocitem" href="../../physics/turbulence_closures/">Turbulence closures</a></li><li><a class="tocitem" href="../../physics/surface_gravity_waves/">Surface gravity waves and the Craik-Leibovich approximation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox" checked/><label class="tocitem" for="menuitem-9"><span class="docs-label">Numerical implementation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../finite_volume/">Finite volume method</a></li><li><a class="tocitem" href="../spatial_operators/">Spatial operators</a></li><li><a class="tocitem" href="../pressure_decomposition/">Pressure decomposition</a></li><li><a class="tocitem" href="../time_stepping/">Time stepping</a></li><li class="is-active"><a class="tocitem" href>Boundary conditions</a><ul class="internal"><li><a class="tocitem" href="#Gradient-boundary-conditions"><span>Gradient boundary conditions</span></a></li><li><a class="tocitem" href="#Value-boundary-conditions"><span>Value boundary conditions</span></a></li><li><a class="tocitem" href="#Flux-boundary-conditions"><span>Flux boundary conditions</span></a></li><li><a class="tocitem" href="#Open-boundary-conditions"><span>Open boundary conditions</span></a></li></ul></li><li><a class="tocitem" href="../elliptic_solvers/">Elliptic solvers</a></li><li><a class="tocitem" href="../large_eddy_simulation/">Large eddy simulation</a></li></ul></li><li><a class="tocitem" href="../../simulation_tips/">Simulation tips</a></li><li><a class="tocitem" href="../../contributing/">Contributor&#39;s guide</a></li><li><a class="tocitem" href="../../gallery/">Gallery</a></li><li><a class="tocitem" href="../../references/">References</a></li><li><input class="collapse-toggle" id="menuitem-14" type="checkbox"/><label class="tocitem" for="menuitem-14"><span class="docs-label">Appendix</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../appendix/staggered_grid/">Staggered grid</a></li><li><a class="tocitem" href="../../appendix/fractional_step/">Fractional step method</a></li><li><a class="tocitem" href="../../appendix/convergence_tests/">Convergence tests</a></li><li><a class="tocitem" href="../../appendix/benchmarks/">Performance benchmarks</a></li><li><a class="tocitem" href="../../appendix/library/">Library</a></li><li><a class="tocitem" href="../../appendix/function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Numerical implementation</a></li><li class="is-active"><a href>Boundary conditions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Boundary conditions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/Oceananigans.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/Oceananigans.jl/blob/main/docs/src/numerical_implementation/boundary_conditions.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="numerical_bcs"><a class="docs-heading-anchor" href="#numerical_bcs">Numerical implementation of boundary conditions</a><a id="numerical_bcs-1"></a><a class="docs-heading-anchor-permalink" href="#numerical_bcs" title="Permalink"></a></h1><p>We adopt a mixed approach for implementing boundary conditions that uses both halo regions and &quot;direct&quot; imposition of boundary conditions, depending on the condition prescribed.</p><p>We illustrate how boundary conditions are implemented by considering the tracer equation</p><p class="math-container">\[    \begin{align}
    \partial_t c = - \boldsymbol{v} \boldsymbol{\cdot} \boldsymbol{\nabla} c
                   - \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{q}_c
                   + F_c \, ,
    \label{eq:tracer}
    \end{align}\]</p><p>where <span>$\boldsymbol{q}_c$</span> is the diffusive flux of <span>$c$</span> and <span>$F_c$</span> is an arbitrary source term.</p><p>See <a href="../../model_setup/boundary_conditions/#model_step_bcs">Model setup: boundary conditions</a> for how to create and use these boundary conditions in Oceananigans.</p><h2 id="Gradient-boundary-conditions"><a class="docs-heading-anchor" href="#Gradient-boundary-conditions">Gradient boundary conditions</a><a id="Gradient-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-boundary-conditions" title="Permalink"></a></h2><p>Users impose gradient boundary conditions by prescribing the gradient <span>$\gamma$</span> of a field <span>$c$</span> across an <em>external boundary</em> <span>$\partial \Omega_b$</span>. The prescribed gradient <span>$\gamma$</span> may be a constant, discrete array of values, or an arbitrary function. The gradient boundary condition is enforced setting the value of halo points located outside the domain interior such that</p><p class="math-container">\[    \begin{equation}
    \label{eq:gradient-bc}
    \hat{\boldsymbol{n}} \boldsymbol{\cdot} \boldsymbol{\nabla} c |_{\partial \Omega_b} = \gamma \, .
    \end{equation}\]</p><p>where <span>$\hat{\boldsymbol{n}}$</span> is the vector normal to <span>$\partial \Omega_b$</span>.</p><p>Across the bottom boundary in <span>$z$</span>, for example, this requires that</p><p class="math-container">\[    \begin{equation}
    \label{eq:linear-extrapolation}
    c_{i, j, 0} = c_{i, j, 1} + \gamma_{i, j, 1} \tfrac{1}{2} \left ( \Delta z_{i, j, 1} + \Delta z_{i, j, 0} \right ) \, ,
    \end{equation}\]</p><p>where <span>$\Delta z_{i, j, 1} = \Delta z_{i, j, 0}$</span> are the heights of the finite volume at <span>$i, j$</span> and <span>$k=1$</span> and <span>$k=0$</span>. This prescription implies that the <span>$z$</span>-derivative of <span>$c$</span> across the boundary at <span>$k=1$</span> is</p><p class="math-container">\[    \begin{equation}
    \partial_z c \, |_{i, j, 1} \equiv
        \frac{c_{i, j, 1} - c_{i, j, 0}}{\tfrac{1}{2} \left ( \Delta z_{i, j, 1} + \Delta z_{i, j, 0} \right )}
            = \gamma_{i, j, 1} \, ,
    \end{equation}\]</p><p>as prescribed by the user.</p><p>Gradient boundary conditions are represented by the <a href="../../appendix/library/#Oceananigans.BoundaryConditions.Gradient"><code>Gradient</code></a> type.</p><h2 id="Value-boundary-conditions"><a class="docs-heading-anchor" href="#Value-boundary-conditions">Value boundary conditions</a><a id="Value-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Value-boundary-conditions" title="Permalink"></a></h2><p>Users impose value boundary conditions by prescribing <span>$c^b$</span>, the value of <span>$c$</span> on the external boundary <span>$\partial \Omega_b$</span>. The value <span>$c^b$</span> may be a constant, array of discrete values, or an arbitrary function. To enforce a value boundary condition, the gradient associated with the difference between <span>$c^b$</span> and <span>$c$</span> at boundary-adjacent nodes is diagnosed and used to set the value of the <span>$c$</span> halo point located outside the boundary.</p><p>At the bottom boundary in <span>$z$</span>, for example, this means that the gradient of <span>$c$</span> is determined by</p><p class="math-container">\[    \begin{equation}
    \gamma = \frac{c_{i, j, 1} - c^b_{i, j, 1}}{\tfrac{1}{2} \Delta z_{i, j, 1}} \, ,
    \end{equation}\]</p><p>which is then used to set the halo point <span>$c_{i, j, 0}$</span> via linear extrapolation.</p><p>Value boundary conditions are represented by the <a href="../../appendix/library/#Oceananigans.BoundaryConditions.Value"><code>Value</code></a> type.</p><h2 id="Flux-boundary-conditions"><a class="docs-heading-anchor" href="#Flux-boundary-conditions">Flux boundary conditions</a><a id="Flux-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-boundary-conditions" title="Permalink"></a></h2><p>Users impose flux boundary conditions by prescribing the flux <span>$q_c \, |_b$</span> of <span>$c$</span> across the external boundary <span>$\partial \Omega_b$</span>. The flux <span>$q_c \, |_b$</span> may be a constant, array of discrete values, or arbitrary function. To explain how flux boundary conditions are imposed in <code>Oceananigans.jl</code>, we note that the average of the tracer conservation equation over a finite volume yields</p><p class="math-container">\[    \begin{equation}
    \label{eq:dc/dt}
    \partial_t c_{i, j, k} = - \frac{1}{V_{i, j, k}} \oint_{\partial \Omega_{i, j, k}} (\boldsymbol{v} c + \boldsymbol{q}_c)
                                                     \boldsymbol{\cdot} \hat{\boldsymbol{n}}  \, \mathrm{d} S
                             + \frac{1}{V_{i, j, k}} \int_{V_{i, j, k}} F_c \, \mathrm{d} V \, ,
    \end{equation}\]</p><p>where the surface integral over <span>$\partial \Omega_{i, j, k}$</span> averages the flux of <span>$c$</span> across the six faces of the finite volume. The right-hand-side of \eqref{eq:dc/dt} above is denoted as <span>$G_c |_{i, j, k}$</span>.</p><p>An external boundary of a finite volume is associated with a no-penetration condition such that <span>$\hat{\boldsymbol{n}} \boldsymbol{\cdot} \boldsymbol{v} \, |_{\partial \Omega_b} = 0$</span>, where <span>$\hat{\boldsymbol{n}}$</span> is the vector normal to <span>$\partial \Omega_b$</span>. Furthermore, the closures currently available in <code>Oceananigans.jl</code> have the property that <span>$\boldsymbol{q}_c \propto \boldsymbol{\nabla} c$</span>. Thus setting <span>$\hat{\boldsymbol{n}} \boldsymbol{\cdot} \boldsymbol{\nabla} c \, |_{\partial \Omega_b} = 0$</span> on the external boundary implies that the total flux of <span>$c$</span> across the external boundary is</p><p class="math-container">\[    \begin{equation}
    \hat{\boldsymbol{n}} \boldsymbol{\cdot} \left ( \boldsymbol{v} c + \boldsymbol{q}_c \right ) |_{\partial \Omega_b} = 0 \, .
    \end{equation}\]</p><p><code>Oceananigans.jl</code> exploits this fact to define algorithm that prescribe fluxes across external boundaries <span>$\partial \Omega_b$</span>:</p><ol><li><p>Impose a constant gradient <span>$\hat{\boldsymbol{n}} \boldsymbol{\cdot} \boldsymbol{\nabla} c \, |_{\partial \Omega_b} = 0$</span> across external boundaries via using halo points (similar to \eqref{eq:gradient-bc}), which ensures that the evaluation of <span>$G_c$</span> in boundary-adjacent cells does not include fluxes across the external boundary, and;</p></li><li><p>Add the prescribed flux to the boundary-adjacent volumes prior to calculating <span>$G_c$</span>: <span>$G_c \, |_b = G_c \, |_b - \frac{A_b}{V_b} q_c \, |_b \, \text{sign}(\hat{\boldsymbol{n}})$</span>, where <span>$G_c \, |_b$</span> denotes values of <span>$G_c$</span> in boundary-adjacent volumes, <span>$q_c \, |_b$</span> is the flux prescribed along the boundary, <span>$V_b$</span> is the volume of the boundary-adjacent cell, and <span>$A_b$</span> is the area of the external boundary of the boundary-adjacent cell.</p><p>The factor <span>$\text{sign}(\hat{\boldsymbol{n}})$</span> is <span>$-$</span>1 and <span>$+$</span>1 on &quot;left&quot; and &quot;right&quot; boundaries, and accounts for the fact that a positive flux on a left boundary where <span>$\text{sign}(\hat{\boldsymbol{n}}) = -1$</span> implies an &quot;inward&quot; flux of <span>$c$</span> that increases interior values of <span>$c$</span>, whereas a positive flux on a right boundary where <span>$\text{sign}(\hat{\boldsymbol{n}}) = 1$</span> implies an &quot;outward&quot; flux that decreases interior values of <span>$c$</span>.</p></li></ol><p>Flux boundary conditions are represented by the <a href="../../appendix/library/#Oceananigans.BoundaryConditions.Flux"><code>Flux</code></a> type.</p><h2 id="Open-boundary-conditions"><a class="docs-heading-anchor" href="#Open-boundary-conditions">Open boundary conditions</a><a id="Open-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Open-boundary-conditions" title="Permalink"></a></h2><p>Open boundary conditions directly specify the value of the halo points. Typically this is used to impose no penetration boundary conditions, i.e. setting wall normal velocity components on to zero on the boundary.</p><p>The nuance here is that open boundaries behave differently for fields on face points in the boundary direction due to the <a href="../finite_volume/#finite_volume">staggered grid</a>. For example, the u-component of velocity lies on <code>(Face, Center, Center)</code> points so for open <code>west</code> or <code>east</code> boundaries the point specified by the boundary condition is the point lying on the boundary, where as for a tracer on <code>(Center, Center, Center)</code> points the open boundary condition specifies a point outside of the domain (hence the difference with <code>Value</code> boundary conditions).</p><p>The other important detail is that open (including no-penetration) boundary conditions are the only conditions used on wall normal velocities when the domain is not periodic. This means that their value affects the pressure calculation for nonhydrostatic models as it is involved in calculating the divergence in the boundary adjacent center point (as described in the <a href="../time_stepping/#time_stepping">fractional step method</a> documentation). Usually boundary points are filled for the predictor velocity (i.e. before the pressure is calculated), and on the corrected field (i.e. after the pressure correction is applied), but for open boundaries this would result in the boundary adjacent center point becoming divergent so open boundaries are only filled for the predictor velocity and stay the same after the pressure correction (so the boundary point is filled with the final corrected velocity at the predictor step).</p><p>The restriction arrises as the boundary condition is specifying the wall normal velocity, <span>$\hat{\boldsymbol{n}}\cdot\boldsymbol{u}$</span>, which leads to the pressure boundary condition</p><p class="math-container">\[    \begin{equation}
    \label{eq:pressure_boundary_condition}
    \Delta t \, \hat{\boldsymbol{n}}\cdot\boldsymbol{\nabla}p^{n+1}\big |_{\partial\Omega} = \left[\Delta t \, \hat{\boldsymbol{n}}\cdot\boldsymbol{u}^\star - \hat{\boldsymbol{n}}\cdot\boldsymbol{u}^{n+1}\right],
    \end{equation}\]</p><p>implying that there is a pressure gradient across the boundary. Since we solve the pressure poisson equation (<span>$\nabla^2p^{n+1}=\frac{\boldsymbol{\nabla}\cdot\boldsymbol{u}^\star}{\Delta t}$</span>) using the method described by <a href="../../references/#Schumann88">Schumann and Sweet (1988)</a> we have to move inhomogeneus boundary conditions on the pressure to the right hand side. In order to do this we define a new field <span>$\phi$</span> where</p><p class="math-container">\[    \begin{equation}
    \label{eq:modified_pressure_field}
    \phi = p^{n+1} \quad \text{inside} \quad \Omega \quad \text{but} \quad \boldsymbol{\nabla} \cdot \boldsymbol{\nabla} \phi \, \big |_{\partial\Omega} = 0.
    \end{equation}\]</p><p>This moves the boundary condition to the right hand side as <span>$\phi$</span> becomes</p><p class="math-container">\[    \begin{equation}
    \label{eq:modified_pressure_poisson}
    \boldsymbol{\nabla}^2\phi^{n+1} = \boldsymbol{\nabla}\cdot\left[\frac{\boldsymbol{u}^\star}{\Delta t} - \delta\left(\boldsymbol{x} - \boldsymbol{x}_\Omega\right)\boldsymbol{\nabla}p\right].
    \end{equation}\]</p><p>Given the boundary condition on pressure given above, we can define a new modified predictor velocity which is equal to the predictor velocity within the domain but shares boundary conditions with the corrected field,</p><p class="math-container">\[    \begin{equation}
    \label{eq:quasi_predictor_velocity}
    \tilde{\boldsymbol{u}}^\star:=\boldsymbol{u}^\star + \delta\left(\boldsymbol{x} - \boldsymbol{x}_\Omega\right)(\boldsymbol{u}^{n+1} - \boldsymbol{u}^\star).
    \end{equation}\]</p><p>The modified pressure poisson equation becomes <span>$\nabla^2p^{n+1}=\frac{\boldsymbol{\nabla}\cdot\tilde{\boldsymbol{u}}^\star}{\Delta t}$</span> which can easily be solved.</p><p>Perhaps a more intuitive way to consider this is to recall that the corrector step projects <span>$\boldsymbol{u}^\star$</span> to the space of divergenece free velocity by applying</p><p class="math-container">\[    \begin{equation}
    \label{eq:pressure_correction_step}
    \boldsymbol{u}^{n+1} = \boldsymbol{u}^\star - \Delta t\boldsymbol{\nabla}p^{n+1},
    \end{equation}\]</p><p>but we have changed <span>$p^{n+1}$</span> to <span>$\phi$</span> and <span>$\boldsymbol{u}^\star$</span> to <span>$\tilde{\boldsymbol{u}}^\star$</span> so for <span>$\boldsymbol{\nabla}\phi \big |_{\partial\Omega} = 0$</span> the modified predictor velocity must equal the corrected velocity on the boundary.</p><p>For simple open boundary conditions such as no penetration or a straight forward prescription of a known velocity at <span>$t^{n+1}$</span> this is simple to implement as we just set the boundary condition on the predictor velocity and don&#39;t change it after the correction. But some open boundary methods calculate the boundary value based on the interior solution. As a simple example, if we wanted to set the wall normal veloicty gradient to zero at the west boundary then we would set the boundary point to</p><p class="math-container">\[    \begin{equation}
    \label{eq:zero_wall_normal_velocity_gradient}
    u^\star_{1jk} \approx u^\star_{3jk} + (u^\star_{2jk} - u^\star_{jk4}) / 2 + \mathcal{O}(\Delta x^2),
    \end{equation}\]</p><p>but we then pressure correct the interior so a new <span>$\mathcal{O}(\Delta t)$</span> error is introduced as</p><p class="math-container">\[    \begin{align}
    u^{n+1}_{1jk} &amp;\approx u^{n+1}_{3jk} + (u^{n+1}_{2jk} - u^{n+1}_{jk4}) / 2 + \mathcal{O}(\Delta x^2),\\
    &amp;= u^\star_{1jk} - \Delta t \left(\boldsymbol{\nabla}p^{n+1}_{3jk} + (\boldsymbol{\nabla}p^{n+1}_{2jk} - \boldsymbol{\nabla}p^{n+1}_{4jk}) / 2\right) + \mathcal{O}(\Delta x^2),\\
    &amp;\approx u^\star_{1jk} + \mathcal{O}(\Delta x^2) + \mathcal{O}(\Delta t).
    \end{align}\]</p><p>This is prefered to a divergent interior solution as open boundary conditions (except no penetration) are typlically already unphysical and only used in an attempt to allow information to enter or exit the domain.</p><p>Open boundary conditions are represented by the <a href="../../appendix/library/#Oceananigans.BoundaryConditions.Open"><code>Open</code></a> type.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../time_stepping/">« Time stepping</a><a class="docs-footer-nextpage" href="../elliptic_solvers/">Elliptic solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Thursday 3 July 2025 16:56">Thursday 3 July 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
